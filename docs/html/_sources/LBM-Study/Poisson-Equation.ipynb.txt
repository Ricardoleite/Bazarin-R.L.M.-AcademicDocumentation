{
 "cells": [
  {
   "cell_type": "markdown",
   "id": "9a8e2211",
   "metadata": {},
   "source": [
    "# Poisson Equation\n",
    "\n",
    "The Poisson is partial differential equation usual employed to represent problems as the pressure distribution over steady-state in space.\n",
    "\n",
    "$$\n",
    "\\partial_{\\alpha}\\left( -D \\partial_{\\alpha}p \\right) = 0.\n",
    "$$(poisson-eq-lb)\n",
    "\n",
    "where $p$ is the pressure and $D$ diffusive control paremeter."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "dbf33e48-d189-4ae1-bd4d-3c39a12e5035",
   "metadata": {},
   "source": [
    "## Lattice Boltzmann Equation\n",
    "\n",
    "Describing the problem through the BGK lattice Boltzmann equation (BGK-LB):\n",
    "\n",
    "$$\n",
    "f_i( x_{\\alpha} + e_{i,\\alpha} \\delta t, t'+\\delta t) = f_i(x_{\\alpha}, t')  -\\left( \\frac{ f_{i} - f_{i}^{eq} }{ \\tau } \\right), \n",
    "$$(LB-Poisson-Eq)\n",
    "\n",
    "the equilibrium distribution function is defined by\n",
    "\n",
    "$$\n",
    "f^{eq}_{i} = \\left\\{ \\begin{array}{ll}\n",
    "   \\left(w_{0} - 1\\right)\\widehat{p}(x_{\\alpha}, t')  & i=0 \\\\\n",
    "   w_{i}\\widehat{p}(x_{\\alpha}, t')  & i\\neq 0\n",
    "\\end{array} \\right. ,\n",
    "$$\n",
    "\n",
    "where $\\widehat{p}$ is the dimensionless pressure, scaled by a reference pressure $p_{0}$, i.e., $p=p_{0}\\widehat{p}$. The equilibrium moments are given by \n",
    "\n",
    "$$\n",
    "\\displaystyle\\sum_{i=0} f_{i}^{eq}=0, \\quad \\quad \\frac{1}{1-w_{0}}\\displaystyle\\sum_{i=1} f_{i}^{eq} = \\frac{1}{1-w_{0}} \\displaystyle\\sum_{i=1} f_{i}=\\widehat{p}, \\quad \\quad  \\displaystyle\\sum_{i}f_{i}^{eq} e_{i,\\alpha} =0 \\quad \\quad \\textrm{and} \\quad \\quad  \\displaystyle\\sum_{i}f_{i}^{eq} e_{i,\\alpha} e_{i,\\beta} =c_{s}^{2} \\widehat{p} \\delta_{\\alpha\\beta} .\n",
    "$$(moments-fi)\n",
    "\n",
    "Through Chapman–Enskog analysis, it is demonstrated that the first-order non-equilibrium moment describes the pressure gradient and, consequently, the average velocity:\n",
    "\n",
    "$$\n",
    "m^{neq}_{\\alpha} = \\displaystyle\\sum_{i} e_{i,\\alpha}\\left( f_i-f_i^{eq}\\right)  = -(c_{s}^{2} \\tau \\delta_{t})\\partial_{\\alpha}\\widehat{p} \\quad \\quad \\textrm{and} \\quad\\quad \\tau = \\displaystyle\\frac{D}{c_{s}^{2} \\delta_{t}} +\\frac{1}{2}.\n",
    "$$"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "d5c5668b-0559-426f-9f1d-eacdc3eac4e8",
   "metadata": {},
   "source": [
    "### Lattice Direction Moments"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "id": "31958af6-d079-41e8-92d0-44e575b8d8f9",
   "metadata": {
    "editable": true,
    "slideshow": {
     "slide_type": ""
    },
    "tags": [
     "hide-input"
    ]
   },
   "outputs": [],
   "source": [
    "import warnings\n",
    "warnings.filterwarnings(\"ignore\")\n",
    "from pylab import *\n",
    "from __future__ import division\n",
    "from sympy import *\n",
    "import numpy as np\n",
    "from sympy import S, collect, expand, factor, Wild\n",
    "from sympy import fraction, Rational, Symbol\n",
    "from sympy import symbols, sqrt, Rational\n",
    "import sympy as sp\n",
    "from IPython.display import display, Math, Latex\n",
    "#-------------------------------------------------Símbolos----------------------------------------------\n",
    "omega, p, w = symbols('omega, p, w')\n",
    "wi, cx, cy, cs = symbols('w_{i} c_{x} c_{y} c_{s}')\n",
    "fi, f0, f1, f2, f3, f4, f5, f6, f7, f8,  = symbols('f_{i} f_{0} f_{1} f_{2} f_{3} f_{4} f_{5} f_{6} f_{7} f_{8}')\n",
    "#-------------------------------------------------Funções----------------------------------------------\n",
    "feq = Function('feq')(wi, cx, cy)\n",
    "fneq = Function('fneq')(wi, cx, cy)\n",
    "f = Function('f')(fi)\n",
    "#-------------------------------------------------Variáveis----------------------------------------------\n",
    "fi=np.array([f1,f2,f3,f4,f5,f6,f7,f8])\n",
    "w0=Rational(4,9);w1=Rational(1,9);w2=Rational(1,36)\n",
    "wi=np.array([w0,w1,w1,w1,w1,w2,w2,w2,w2])\n",
    "cx=np.array([0,1,0,-1,0,1,-1,-1,1])\n",
    "cy=np.array([0,0,1,0,-1,1,1,-1,-1])\n",
    "as2=Rational(3)\n",
    "cs2=1/as2\n",
    "#-------------------------------------------------Calc.Func------------------------------------------------\n",
    "f= fi\n",
    "feq=wi*p\n",
    "feq[0]=(w0-1)*p"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "id": "101dbaeb-38c6-4241-9ba9-14accc9c9836",
   "metadata": {
    "editable": true,
    "slideshow": {
     "slide_type": ""
    },
    "tags": [
     "hide-input"
    ]
   },
   "outputs": [
    {
     "data": {
      "text/latex": [
       "$\\displaystyle \\underbrace{\\sum_{i=0} f_{i}^{eq} =\\sum_{i=0} f_{i} }_{\\textrm{Zero-Order Moment}} =0, \\quad \\quad \\underbrace{\\frac{1}{(1-w_{0})}\\sum_{i=1} f_{i}^{eq} = \\frac{1}{(1-w_{0})}\\sum_{i=1} f_{i} }_{\\textrm{Zero-Order Moment}} =p,\\quad \\quad \\underbrace{\\sum_{i=0} f_{i}^{eq}e_{i,x} }_{\\textrm{x-First-Order Moment}} =0,\\quad \\quad \\underbrace{\\sum_{i=0} f_{i}^{eq}e_{i,y} }_{\\textrm{y-First-Order Moment}} =0,\\\\ \\quad \\quad \\underbrace{\\sum_{i=0} f_{i}^{eq}e_{i,x}e_{i,x} }_{\\textrm{xx-Second-Order Moment}} =\\frac{p}{3},\\quad \\quad \\underbrace{\\sum_{i=0} f_{i}^{eq}e_{i,x}e_{i,y} }_{\\textrm{xy-Second-Order Moment}} =0 \\quad \\quad and \\quad \\quad \\underbrace{\\sum_{i=0} f_{i}^{eq}e_{i,y}e_{i,y} }_{\\textrm{yy-Second-Order Moment}} =\\frac{p}{3}$"
      ],
      "text/plain": [
       "<IPython.core.display.Math object>"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    }
   ],
   "source": [
    "a0=simplify(sum(feq[1:]))/(1-w0)\n",
    "# display(Math(r\"\\underbrace{\\sum_{i=1}^{8}f_{i}^{eq} =\\sum_{i=1}^{8}f_{i} }_{\\textrm{Zero-Order Moment}} =\" +  sp.latex(a0) ))\n",
    "ax=simplify(sum(feq*cx))\n",
    "# display(Math(r\"\\sum_{i=0}^{8}f_{i}^{eq}e_{i,x} =\" +  sp.latex(ax) ))\n",
    "ay=simplify(sum(feq*cy))\n",
    "# display(Math(r\"\\sum_{i=0}^{8}f_{i}^{eq}e_{i,y} =\" +  sp.latex(ay) ))\n",
    "axx=simplify(sum(feq*cx*cx))\n",
    "# display(Math(r\"\\sum_{i=0}^{8}f_{i}^{eq}e_{i,x}e_{i,x} =\" +  sp.latex(axx) ))\n",
    "axy=simplify(sum(feq*cx*cy))\n",
    "# display(Math(r\"\\sum_{i=0}^{8}f_{i}^{eq}e_{i,x}e_{i,y} =\" +  sp.latex(axy) ))\n",
    "ayy=simplify(sum(feq*cy*cy))\n",
    "# display(Math(r\"\\sum_{i=0}^{8}f_{i}^{eq}e_{i,y}e_{i,y} =\" +  sp.latex(ayy) ))\n",
    "display(Math(r\"\\underbrace{\\sum_{i=0} f_{i}^{eq} =\\sum_{i=0} f_{i} }_{\\textrm{Zero-Order Moment}} =0,\"\n",
    "            +r\" \\quad \\quad \\underbrace{\\frac{1}{1-w_{0}}\\sum_{i=1} f_{i}^{eq} = \\frac{1}{1-w_{0}}\\sum_{i=1} f_{i} }_{\\textrm{Zero-Order Moment}} =\" +  sp.latex(a0)\n",
    "            +r\",\\quad \\quad \\underbrace{\\sum_{i=0} f_{i}^{eq}e_{i,x} }_{\\textrm{x-First-Order Moment}} =\" +  sp.latex(ax)\n",
    "            +r\",\\quad \\quad \\underbrace{\\sum_{i=0} f_{i}^{eq}e_{i,y} }_{\\textrm{y-First-Order Moment}} =\" +  sp.latex(ay)\n",
    "            +r\",\\\\ \\quad \\quad \\underbrace{\\sum_{i=0} f_{i}^{eq}e_{i,x}e_{i,x} }_{\\textrm{xx-Second-Order Moment}} =\" +  sp.latex(axx)\n",
    "            +r\",\\quad \\quad \\underbrace{\\sum_{i=0} f_{i}^{eq}e_{i,x}e_{i,y} }_{\\textrm{xy-Second-Order Moment}} =\" +  sp.latex(axy)\n",
    "            +r\" \\quad \\quad and \\quad \\quad \\underbrace{\\sum_{i=0} f_{i}^{eq}e_{i,y}e_{i,y} }_{\\textrm{yy-Second-Order Moment}} =\" +  sp.latex(ayy)))"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "05d52e5c-de34-4f25-8bf2-99be1d5a35bd",
   "metadata": {
    "editable": true,
    "slideshow": {
     "slide_type": ""
    },
    "tags": []
   },
   "source": [
    "## Chapmann-Enskog Analysis"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "e1ef21b7",
   "metadata": {
    "hide_input": true,
    "tags": [
     "hide-input"
    ]
   },
   "source": [
    "Applying the Chapmann-Enskog procedure to LB equation, we expand the term $f_{i}\\left(\\boldsymbol{x}+\\boldsymbol{e}_i \\Delta t, t+\\Delta t\\right)$ in a Taylor series to recover the derivative form of the equation, i.e.,\n",
    "\n",
    "$$\n",
    "f_{i}\\left(\\boldsymbol{x}+\\boldsymbol{e}_i \\Delta t, t+\\Delta t\\right)- f_{i}(\\boldsymbol{x}, t)=\\displaystyle\\sum_{j=1}^{\\infty}\\frac{\\Delta t^{j}}{j!}D_{t}^{j}f_{i}= -\\left( \\frac{ f_{i} - f_{i}^{eq} }{ \\tau } \\right).\n",
    "$$(EqExp-Poisson-Eq)\n",
    "\n",
    "Rescaling the dimensionless form of the Eq. {eq}`EqExp-Poisson-Eq` in terms of the Knudsen number ($Kn$), we have\n",
    "\n",
    "$$\n",
    "\\displaystyle \\sum^{\\infty}_{j=1}  \\frac{Kn^{(j-1)}}{j!} D_{t}^{j} f_{i} = - \\frac{1}{Kn}\\left( \\frac{ f_{i} - f_{eq,i} }{ \\tau } \\right) \\quad \\quad \\rightarrow \\quad \\quad \\displaystyle \\sum^{\\infty}_{j=1}  \\frac{Kn^{(j)}}{j!} D_{t}^{j} f_{i} = -  \\frac{ f_{i} - f_{i}^{eq} }{ \\tau },\n",
    "$$\n",
    "\n",
    "applying the asymptotic expansion in both the distribution function ($f_{i}=f_{i}^{(0)}+Kn f_{i}^{(1)} + Kn^{2} f_{i}^{(2)}+\\cdots$) and time partial derivative ($\\partial_{t}=\\partial_{t}^{(0)}+ Kn \\partial_{t}^{(1)}+Kn^{2} \\partial_{t}^{(2)}+\\cdots$), and separating the equation in orders up to the order $Kn^{2}$:\n",
    "\n",
    "$$\n",
    "\\begin{array}{ll}\n",
    "    (Kn^{(0)}):& f_{i}^{(0)}= f_{i}^{eq},\\\\\n",
    "    (Kn^{(1)}):& \\left( \\partial_{t}^{(0)} + e_{i,\\alpha}\\partial_{\\alpha} \\right)f_{i}^{(0)}= - \\displaystyle\\frac{ f_{i}^{(1)} }{ \\tau } , \\\\\n",
    "    (Kn^{(2)}):& \\partial_{t}^{(1)} f_{i}^{(0)} + \\left( \\partial_{t}^{(0)} + e_{i,\\alpha}\\partial_{\\alpha} \\right)f_{i}^{(0)} + \\displaystyle\\frac{\\left( \\partial_{t}^{(0)} + e_{i,\\alpha}\\partial_{\\alpha} \\right)^{2} f_{i}^{(0)}}{2}= - \\displaystyle\\frac{ f_{i}^{(2)} }{ \\tau },\\\\\n",
    "    \\textrm{ou}\\\\\n",
    "    (Kn^{(2)}):& \\partial_{t}^{(1)} f_{i}^{(0)} + \\left( \\partial_{t}^{(0)} + e_{i,\\alpha}\\partial_{\\alpha} \\right)\\displaystyle\\left(1 - \\frac{1}{2\\tau}\\right) f_{i}^{(1)} =  - \\displaystyle\\frac{ f_{i}^{(2)} }{ \\tau } \\quad\\quad \\rightarrow \\quad\\quad  f_{i}^{(1)}\\textrm{ Formulation} \\\\\n",
    "    \\textrm{ou}\\\\\n",
    "    (Kn^{(2)}):& \\partial_{t}^{(1)} f_{i}^{(0)} + \\left( \\partial_{t}^{(0)} + e_{i,\\alpha}\\partial_{\\alpha} \\right)^{2} \\displaystyle\\left(\\frac{1}{2} - \\tau\\right) f_{i}^{(0)} =  - \\displaystyle\\frac{ f_{i}^{(2)} }{ \\tau } \\quad\\quad \\rightarrow  \\quad\\quad f_{i}^{(0)}\\textrm{ Formulation}.\n",
    " \\end{array}\n",
    "$$(Chap-Kn-Poisson-Eq)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "31f290a1-5316-4239-b8d7-9829cc6d1194",
   "metadata": {},
   "source": [
    "## Zero-Order Moment Balance\n",
    "\n",
    "To retrieve the balance equation, we sum the Eq. {eq}`Chap-Kn-Poisson-Eq` for $Kn^{(1)}$ and $Kn^{(2)}$ over $\\sum_{i=0} $:\n",
    "\n",
    "$$\n",
    "\\begin{array}{l}\n",
    "(Kn^{(1)}): \\displaystyle\\sum_{i}\\left( \\partial_{t}^{(0)} + e_{i,\\alpha}\\partial_{\\alpha} \\right)f_{i}^{(0)}= \\displaystyle\\sum_{i} \\left(- \\displaystyle\\frac{ f_{i}^{(1)} }{ \\tau } \\right),\\\\\n",
    "(Kn^{(1)}): 0  =0,\n",
    "\\end{array}\n",
    "$$\n",
    "\n",
    "and\n",
    "\n",
    "$$\n",
    "\\begin{array}{l}\n",
    "(Kn^{(2)}): \\displaystyle\\sum_{i}\\left( \\partial_{t}^{(1)} f_{i}^{(0)} + \\left( \\partial_{t}^{(0)} + e_{i,\\alpha}\\partial_{\\alpha} \\right)^{2} \\displaystyle\\left( \\frac{1}{2}-\\tau\\right) f_{i}^{(0)} \\right) =  \\displaystyle\\sum_{i}\\left( - \\displaystyle\\frac{ f_{i}^{(2)} }{ \\tau } \\right), \\\\\n",
    "(Kn^{(2)}): \\left( \\displaystyle\\frac{1}{2}-\\tau\\right) \\partial_{\\alpha}\\partial_{\\beta} \\left(c_{s}^{2} p \\delta_{\\alpha\\beta} \\right) =0. \n",
    "\\end{array}\n",
    "$$\n",
    "\n",
    "or\n",
    "\n",
    "$$\n",
    "\\begin{array}{l}\n",
    "(Kn^{(2)}):& \\displaystyle\\sum_{i}\\left[ \\partial_{t}^{(1)} f_{i}^{(0)} - \\left(1-\\displaystyle\\frac{1}{2\\tau}\\right)\\left( \\partial_{t}^{(0)} + e_{\\alpha,i}\\partial_{\\alpha} \\right) f_{i}^{(1)}   \\right]=  \\displaystyle\\sum_{i}\\left( - \\displaystyle\\frac{f_{i}^{(2)}}{\\tau} \\right), \\nonumber \\\\\n",
    "(Kn^{(2)}):& - \\left(1-\\displaystyle\\frac{1}{2\\tau}\\right) m^{(1)}_{\\alpha} = 0.\n",
    "\\end{array}\n",
    "$$(Kn1-0-B0)\n",
    "\n",
    "where $m^{(1)}_{\\alpha}$ is the first-order moment of $f_{i}^{(1)}$ and $1/(1-w_{0})\\sum_{i=1}f_{i}^{(j)}=0$ for $j\\geq 1$ due to imposition of $\\widehat{p}$ conservation. To compute the moment $m^{(1)}_{\\alpha}$, we multiply Eq. {eq}`Chap-Kn-Poisson-Eq` by $e_{i,\\alpha}$ and sum over all lattice directions:\n",
    "\n",
    "$$\n",
    "\\begin{array}{l}\n",
    "(Kn^{(1)}): \\displaystyle\\sum_{i}e_{\\alpha,i}\\left( \\partial_{t}^{(0)} + e_{\\beta,i}\\partial_{\\beta} \\right)f_{i}^{(0)}= \\displaystyle\\sum_{i} e_{\\alpha,i} \\left( -\\frac{f_{i}^{(1)}}{\\tau}  \\right),\\\\\n",
    "(Kn^{(1)}): m^{(1)}_{\\alpha} =-\\tau \\partial_{\\beta}\\left( c_{s}^{2} \\widehat{p} \\delta_{\\alpha\\beta}  \\right).\n",
    "\\end{array}\n",
    "$$(Kn0-B1)\n",
    "\n",
    "\n",
    "By substituting Eq. {eq}`Kn0-B1` into Eq. {eq}`Kn1-0-B0`, we recover the Eq. {eq}`poisson-eq-lb`, where $D=c_{s}^{2}(\\tau-1/2)$. In the regularized formulation of the lattice Boltzmann equation, the first-order correction is approximated as $f_{i}^{(1)}\\approx (f_{i}-f_{i}^{(0)})=f_{i}^{neq}$, where higher-order Knudsen moments are filtered out."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "4b61894d-6d61-4add-bd4e-df0f4152e4b0",
   "metadata": {},
   "source": [
    "## Boundary Conditions"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "e1f9e820-03c0-4658-9c8c-e6229db31935",
   "metadata": {},
   "source": [
    "## Benchmarks"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "9ca802a9-3991-418f-b749-4c659714cf58",
   "metadata": {},
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "celltoolbar": "Edit Metadata",
  "kernelspec": {
   "display_name": "Python 3 (ipykernel)",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.10.12"
  },
  "varInspector": {
   "cols": {
    "lenName": 16,
    "lenType": 16,
    "lenVar": 40
   },
   "kernels_config": {
    "python": {
     "delete_cmd_postfix": "",
     "delete_cmd_prefix": "del ",
     "library": "var_list.py",
     "varRefreshCmd": "print(var_dic_list())"
    },
    "r": {
     "delete_cmd_postfix": ") ",
     "delete_cmd_prefix": "rm(",
     "library": "var_list.r",
     "varRefreshCmd": "cat(var_dic_list()) "
    }
   },
   "types_to_exclude": [
    "module",
    "function",
    "builtin_function_or_method",
    "instance",
    "_Feature"
   ],
   "window_display": false
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
